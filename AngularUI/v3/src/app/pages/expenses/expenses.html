<div class="container">
  <div class="card shadow-sm border-0">
    <div class="card-body">


      <h2>Expenses Management</h2>
      <div *ngIf="notification()" class="alert alert-info">{{ notification() }}</div>
      <form [formGroup]="expensesForm" (ngSubmit)="submit()" class="mb-4">
        <input type="hidden" formControlName="uniqueId" />
        <div class="row">
          <div class="col-12 justify-content-end align-items-center">
            <div class="row g-2">
              <div class="col-sm-12 col-md-6 col-lg-4 col-xl-3">
                <label for="categoryId" class="form-label">Category</label>
                <div style="position: relative;">
                  <input id="categoryId" #catInput type="text" class="form-control" [value]="categorySearch()"
                    (input)="onCategorySearchChange(catInput.value)" (focus)="onCategoryInputFocus()"
                    (blur)="onCategoryInputBlur()" placeholder="Select Category" autocomplete="off" required />
                  <input type="hidden" formControlName="categoryId" />
                  <ul *ngIf="showCategoryDropdown() && categorySearch()" class="dropdown-menu show w-100"
                    style="max-height: 240px; overflow-y: auto; position: absolute; z-index: 1000;">
                    <li *ngFor="let cat of filteredCategories(); let last = last" (mousedown)="onCategorySelect(cat)"
                      [ngStyle]="cat.parentId === null ? {'font-weight':'bold'} : {}" style="cursor:pointer;">
                      <span *ngIf="cat.parentId !== null">&nbsp;&nbsp;- </span>{{ cat.label }}
                    </li>
                    <li *ngIf="filteredCategories().length === 0" class="dropdown-item text-muted">No results</li>
                    <li *ngIf="hasMoreThan12Matches()" class="dropdown-item text-center">...</li>
                  </ul>
                </div>
              </div>

              <div class="col-sm-12 col-md-6 col-lg-4 col-xl-3">
                <label for="title" class="form-label">Title</label>
                <input id="title" type="text" class="form-control" formControlName="title" required />
              </div>


              <div class="col-sm-12 col-md-6 col-lg-4 col-xl-3">
                <label for="amount" class="form-label">Amount</label>
                <input id="amount" type="number" class="form-control" formControlName="amount" required min="1" />


              </div>
              <div class="col-sm-12 col-md-6 col-lg-4 col-xl-3">
                <label for="expenseDate" class="form-label">Expense Date</label>
                <input id="expenseDate" type="date" class="form-control" formControlName="expenseDate" required />
              </div>


              <div class="row g-2">

                <div class="col-12">
                  <label for="description" class="form-label">Description</label>
                  <input id="description" type="text" class="form-control" formControlName="description" />
                </div>
              </div>

            </div>
          </div>


        </div>
        <div class="mt-4">
          <button type="submit" class="btn btn-primary me-2" [disabled]="expensesForm.invalid || isLoading()">{{
            isEditMode() ? 'Update' : 'Save' }} Expense</button>
          <button type="button" class="btn btn-secondary" (click)="clearForm()">Clear</button>
        </div>



      </form>
      <table class="table table-bordered table-hover">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Category</th>
            <th>Title</th>
            <th>Description</th>
            <th>Amount</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let exp of expenses(); let i = index">
            <td>{{ i + 1 }}</td>
            <td>{{ getCategoryLabel(exp.categoryId) }}</td>
            <td>{{ exp.title }}</td>
            <td>{{ exp.description }}</td>
            <td>{{ exp.amount | currency:'INR':'symbol':'1.0-0' }}</td>
            <td>
              <div class="align-items-center gap-2">
                <button class="btn btn-sm btn-info" (click)="editExpense(exp)">Edit</button>
                <button class="btn btn-sm btn-danger" (click)="deleteExpense(exp.uniqueId!)">Delete</button>
              </div>
            </td>

          </tr>
        </tbody>
      </table>

      <div class="container">
        <div class="card">
          <div class="card-body p-4">
            <h2 class="mb-4 border-bottom pb-2">Recent Transactions</h2>
            <div class="page">
              <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="mb-0">Transactions</h2>
                <div>
                  <button class="btn btn-outline-primary me-2" id="add-income-btn">
                    <i class="bi bi-plus-lg"></i> Add Income
                  </button>
                  <button class="btn btn-primary" id="add-expense-btn">
                    <i class="bi bi-plus-lg"></i> Add Expense
                  </button>
                </div>
              </div>

              <div class="card mb-4">
                <div class="card-body">
                  <div class="row g-3">
                    <div class="col-md-3">
                      <label class="form-label">Date Range</label>
                      <select class="form-select">
                        <option>This Month</option>
                        <option>Last Month</option>
                        <option>Last 3 Months</option>
                        <option>Custom Range</option>
                      </select>
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Type</label>
                      <select class="form-select">
                        <option>All Transactions</option>
                        <option>Income</option>
                        <option>Expense</option>
                      </select>
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Category</label>
                      <select class="form-select">
                        <option>All Categories</option>
                        <option>Food & Dining</option>
                        <option>Transportation</option>
                        <option>Housing</option>
                        <option>Entertainment</option>
                        <option>Utilities</option>
                        <option>Income</option>
                      </select>
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Sort By</label>
                      <select class="form-select">
                        <option>Date (Newest)</option>
                        <option>Date (Oldest)</option>
                        <option>Amount (High to Low)</option>
                        <option>Amount (Low to High)</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>